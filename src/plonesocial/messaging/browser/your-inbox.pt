<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">
  <body>
    <div id="social-messages"
        metal:fill-slot="main">

        <tal:c tal:condition="view/your_messages">
            <tal:def tal:define="inbox view/your_messages">

                <div id="message-title-full"
                     tal:condition="python: inbox['view'] != 'small'">
                    <div id="inbox-new-message-full" class="button">
                        <a tal:attributes="href string:${context/portal_url}/@@messaging-send#content-core"
                           class="pat-modal"
                           data-pat-modal="class: large">New Message</a>
                     </div>
                    <h1>Inbox</h1>
                </div>
                <div id="inbox-messages"
                    tal:attributes="class string: ${inbox/view} list-extend"
                    tal:condition="inbox">
                    <div id="message-title"
                         tal:condition="python: inbox['view'] == 'small'">
                        <a tal:attributes="href string:${context/portal_url}/@@messaging-send#content-core"
                           class="pat-modal float-after button"
                           data-pat-modal="class: large">New Message</a>

                        Inbox
                    </div>
                    <ul class="list" tal:repeat="convo inbox/conversations">
                        <li tal:attributes="class string:item user">
                            <div class="social-message-name">
                                <div class="social-message-created">
                                    <tal:block tal:content="python: context.toLocalizedTime(convo['last-updated'], long_format=0)" />
                                </div>
                                <tal:block tal:content="convo/fullname" />
                            </div>
                            <tal:c tal:condition="convo/messages">
                                <tal:rep tal:repeat="msg convo/messages">
                                    <tal:block tal:replace="structure msg/sender_img" />
                                    <a class="social-message"
                                        tal:attributes="href string:${context/portal_url}/@@social-inbox?user=${convo/username}">
                                        <tal:block tal:content="msg/text" />
                                    </a>
                               </tal:rep>
                            </tal:c>
                        </li>
                    </ul>
                    <ul class="list" tal:condition="not:inbox/conversations">
                        <li class="item empty">
                            <p>No messages</p>
                        </li>
                    </ul>
                    <div id="your-messages-inbox"><a tal:attributes="href string: ${context/portal_url}/@@social-inbox">Your Inbox</a></div>
                </div>
                <div id="conversation-content"
                    tal:condition="python: inbox['view'] != 'small'">
                    <tal:def tal:define="msg inbox/display_message">
                        <tal:con tal:condition="msg">
                            <div class="social-message" tal:repeat="msg msg/full-messages">
                                <tal:block tal:replace="structure msg/sender_img" />
                                <div class="social-message-created">
                                    <tal:block tal:content="python: context.toLocalizedTime(msg['created'], long_format=0)" />
                                </div>
                                <tal:block tal:content="msg/text" />
                                <div class="clearall"></div>
                            </div>
                            <div id="inbox-reply-message-full" class="button">
                                <a tal:attributes="href string: ${context/portal_url}/@@messaging-send">Reply to
                                    <span id="social-reply-to" tal:content="inbox/conv_with" />
                                </a>
                            </div>
                        </tal:con>
                    </tal:def>
                </div>
            </tal:def>
        </tal:c>
    <!-- end main -->
    </div>
  </body>
</html>